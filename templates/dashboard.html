<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cube Dashboard</title>
    <link rel="icon" href="https://fav.farm/üèãÔ∏è">
    <link rel="preload" href="/static/fonts/Inter-Regular.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="/static/fonts/Inter-Bold.ttf" as="font" type="font/ttf" crossorigin>
    <script src="/static/js/purify.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7c3aed;
            --primary-light: #a78bfa;
            --primary-dark: #5b21b6;
            --success: #10b981;
            --success-light: #34d399;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0a0a12;
            --bg-card: #12121f;
            --bg-card-hover: #1a1a2a;
            --bg-input: #0d0d16;
            --text-primary: #ffffff;
            --text-secondary: #b8b8d0;
            --text-muted: #6b6b80;
            --border: #1f1f35;
            --border-light: #2a2a45;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(180deg, var(--bg-dark) 0%, rgba(10, 10, 18, 0.95) 100%);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 1.5rem;
        }

        .logo-text {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .live-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 30px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        .live-count {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success);
        }

        .live-label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
    </style>
    <link rel="stylesheet" href="/static/css/dashboard.css">

    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üèãÔ∏è</span>
                <span class="logo-text">Cube Si≈Çownia #POWER</span>
            </div>
            <div class="live-counter">
                <div class="live-dot"></div>
                <span class="live-count" id="liveCount">--</span>
                <span class="live-label">os√≥b dzisiaj</span>
            </div>
            <div class="user-badge" id="userBadge" onclick="logout()">üë§ ---</div>
        </div>
    </header>

    <!-- TAB NAVIGATION -->
    <nav class="tab-nav">
        <div class="tabs">
            <button class="tab active" data-tab="calendar">
                <span class="tab-icon">üìÖ</span>
                <span>Kalendarz</span>
            </button>
            <button class="tab" data-tab="stats">
                <span class="tab-icon">üìä</span>
                <span>Statystyki</span>
            </button>
            <button class="tab" data-tab="strength">
                <span class="tab-icon">üí™</span>
                <span>Si≈Ça</span>
            </button>
            <button class="tab" data-tab="more">
                <span class="tab-icon">‚öôÔ∏è</span>
                <span>Wiƒôcej</span>
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="container">
        <!-- ============ CALENDAR TAB ============ -->
        <div class="tab-content active" id="tab-calendar">
            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-box">
                    <div class="stat-value" id="weeklyCount">-</div>
                    <div class="stat-label">Ten tydzie≈Ñ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="monthlyCount">-</div>
                    <div class="stat-label">Ten miesiƒÖc</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="mostTrained">-</div>
                    <div class="stat-label">Najczƒô≈õciej</div>
                </div>
            </div>

            <!-- Month Navigation -->
            <div class="month-nav">
                <button onclick="prevMonth()">‚Üê</button>
                <div class="current-month" id="currentMonth">Grudzie≈Ñ 2025</div>
                <button onclick="nextMonth()">‚Üí</button>
            </div>

            <!-- Calendar Grid -->
            <div class="calendar-grid">
                <div class="weekdays">
                    <div class="weekday">Pon</div>
                    <div class="weekday">Wt</div>
                    <div class="weekday">≈ör</div>
                    <div class="weekday">Czw</div>
                    <div class="weekday">Pt</div>
                    <div class="weekday">Sob</div>
                    <div class="weekday">Nd</div>
                </div>
                <div class="days" id="calendarDays"></div>
            </div>

            <!-- Legend -->
            <div class="legend" id="legend"></div>
        </div>

        <!-- ============ STATISTICS TAB ============ -->
        <div class="tab-content" id="tab-stats">
            <!-- Extended Occupancy Stats -->
            <div class="card">
                <div class="card-title">üìä Statystyki ob≈Ço≈ºenia</div>

                <!-- Quick stats row -->
                <div
                    style="display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 4px; -webkit-overflow-scrolling: touch;">
                    <div
                        style="background: var(--bg-input); border-radius: 10px; padding: 12px; text-align: center; flex: 1; min-width: 100px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); white-space: nowrap;"
                            id="statsAvgWeekday">
                            --</div>
                        <div style="font-size: 0.6rem; color: var(--text-muted); white-space: nowrap;"
                            id="statsWeekdayLabel">≈ör. piƒÖtek
                        </div>
                    </div>
                    <div
                        style="background: var(--bg-input); border-radius: 10px; padding: 12px; text-align: center; flex: 1; min-width: 100px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); white-space: nowrap;"
                            id="statsWeekdayHour">--</div>
                        <div style="font-size: 0.6rem; color: var(--text-muted); white-space: nowrap;"
                            id="statsWeekdayHourLabel">≈ör. piƒÖtek
                            o tej porze</div>
                    </div>
                    <div
                        style="background: var(--bg-input); border-radius: 10px; padding: 12px; text-align: center; flex: 1; min-width: 100px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); white-space: nowrap;"
                            id="statsAvgHour">
                            --</div>
                        <div style="font-size: 0.6rem; color: var(--text-muted); white-space: nowrap;">≈ör. o tej porze
                        </div>
                    </div>
                    <div
                        style="background: var(--bg-input); border-radius: 10px; padding: 12px; text-align: center; flex: 1; min-width: 100px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); white-space: nowrap;"
                            id="statsLiveNow">
                            --
                        </div>
                        <div style="font-size: 0.6rem; color: var(--text-muted); white-space: nowrap;">Teraz</div>
                    </div>
                </div>

                <!-- Daily averages chart -->
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 10px;">üìÖ ≈örednia dla
                        ka≈ºdego dnia tygodnia:</div>
                    <div id="dailyChart"
                        style="display: flex; align-items: flex-end; justify-content: space-between; height: 140px; gap: 4px; padding-top: 25px;">
                        <div style="text-align: center; width: 100%; color: var(--text-muted);">≈Åadowanie...</div>
                    </div>
                </div>

                <!-- Hourly averages chart -->
                <div class="hourly-chart-container">
                    <div class="hourly-chart-header">
                        <div class="hourly-chart-title">
                            ‚è∞ ≈örednia wej≈õƒá na godzinƒô (6-23)
                        </div>
                        <div class="hourly-chart-legend">
                            <div class="legend-item-chart">
                                <div class="legend-dot green"></div>
                                <span>Ma≈Ço</span>
                            </div>
                            <div class="legend-item-chart">
                                <div class="legend-dot yellow"></div>
                                <span>≈örednio</span>
                            </div>
                            <div class="legend-item-chart">
                                <div class="legend-dot red"></div>
                                <span>Du≈ºo</span>
                            </div>
                        </div>
                    </div>
                    <div id="hourlyChart" class="hourly-chart">
                        <div style="text-align: center; padding: 40px; width: 100%; color: var(--text-muted);">
                            ≈Åadowanie...</div>
                    </div>
                </div>


                <!-- Best/Worst times -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <!-- Best times -->
                    <div
                        style="background: rgba(16, 185, 129, 0.1); border-radius: 12px; padding: 14px; border: 1px solid rgba(16, 185, 129, 0.2);">
                        <div style="font-size: 0.75rem; color: var(--success); margin-bottom: 10px; font-weight: 600;">
                            üèÜ TOP 3 Najlepsze</div>
                        <div id="bestTimesList" style="display: flex; flex-direction: column; gap: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem;">≈Åadowanie...</div>
                        </div>
                    </div>
                    <!-- Worst times -->
                    <div
                        style="background: rgba(239, 68, 68, 0.1); border-radius: 12px; padding: 14px; border: 1px solid rgba(239, 68, 68, 0.2);">
                        <div style="font-size: 0.75rem; color: var(--danger); margin-bottom: 10px; font-weight: 600;">‚ö†Ô∏è
                            TOP 3 Najgorsze</div>
                        <div id="worstTimesList" style="display: flex; flex-direction: column; gap: 6px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem;">≈Åadowanie...</div>
                        </div>
                    </div>
                </div>

                <!-- New Year Effect Card -->
                <div id="newYearCard"
                    style="margin-top: 16px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(168, 85, 247, 0.15)); border-radius: 12px; padding: 16px; border: 1px solid rgba(139, 92, 246, 0.3);">
                    <div style="font-size: 0.85rem; color: #a78bfa; margin-bottom: 12px; font-weight: 600;">
                        üéÜ EFEKT NOWOROCZNY
                    </div>

                    <div style="display: flex; flex-wrap: wrap; gap: 24px;">
                        <!-- LEFT COLUMN: Main Stats -->
                        <div style="flex: 1; min-width: 220px; display: flex; flex-direction: column; gap: 10px;">
                            <!-- Main percentage change -->
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span
                                    style="font-size: 1.1rem; background: rgba(255,255,255,0.1); padding: 6px; border-radius: 8px;">üìà</span>
                                <span id="newYearMainChange"
                                    style="font-size: 0.95rem; font-weight: 700; color: var(--text-primary);">--</span>
                            </div>

                            <!-- Today's weekday comparison -->
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span
                                    style="font-size: 1.1rem; background: rgba(255,255,255,0.1); padding: 6px; border-radius: 8px;">üìÖ</span>
                                <span id="newYearWeekday"
                                    style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">--</span>
                            </div>

                            <!-- Peak day -->
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span
                                    style="font-size: 1.1rem; background: rgba(255,255,255,0.1); padding: 6px; border-radius: 8px;">üèÜ</span>
                                <span id="newYearPeak"
                                    style="font-size: 0.8rem; color: var(--text-secondary);">--</span>
                            </div>
                        </div>

                        <!-- RIGHT COLUMN: Weekly Trend -->
                        <!-- Using display:none initially, JS toggles to block. 
                             Since block layout works fine for vertical stacking, we don't need flex here. -->
                        <div id="newYearTrend"
                            style="flex: 1; min-width: 220px; display: none; border-left: 1px solid rgba(139, 92, 246, 0.2); padding-left: 24px;">
                            <div
                                style="font-size: 0.75rem; color: #a78bfa; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                                üìä Trend Tygodniowy
                            </div>
                            <div id="newYearWeeklyTrend"
                                style="font-size: 0.85rem; color: var(--text-primary); margin-bottom: 8px; font-weight: 500; line-height: 1.5;">
                                --</div>
                            <div id="newYearDecay"
                                style="display: flex; align-items: center; gap: 8px; font-size: 0.75rem; background: rgba(234, 179, 8, 0.1); padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(234, 179, 8, 0.2); width: fit-content;">
                                <span>‚ö†Ô∏è</span>
                                <span id="newYearDecayText" style="color: var(--warning);">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly Chart -->
            <div class="card">
                <div class="card-title">üìà Treningi tygodniowe (12 tyg.)</div>
                <div class="weekly-chart" id="weeklyChart"></div>
            </div>

            <!-- Month Comparison -->
            <div class="card">
                <div class="card-title">‚öñÔ∏è Por√≥wnanie miesiƒôcy</div>
                <div class="comparison-grid">
                    <div class="comparison-card">
                        <div class="comparison-month" id="prevMonthName">Listopad</div>
                        <div class="comparison-value" id="prevMonthCount">-</div>
                        <div class="comparison-label">trening√≥w</div>
                    </div>
                    <div class="comparison-change neutral" id="comparisonChange">0%</div>
                    <div class="comparison-card">
                        <div class="comparison-month" id="currMonthName">Grudzie≈Ñ</div>
                        <div class="comparison-value" id="currMonthCount">-</div>
                        <div class="comparison-label">trening√≥w</div>
                    </div>
                </div>
            </div>

            <!-- Yearly Heatmap - Simple -->
            <div class="card">
                <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>üî• Aktywno≈õƒá treningowa</span>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button onclick="prevHeatmapYear()"
                            style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); padding: 6px 12px; cursor: pointer; font-size: 0.9rem;">‚Üê</button>
                        <span id="heatmapYear"
                            style="font-size: 0.9rem; font-weight: 600; min-width: 50px; text-align: center;">2025</span>
                        <button onclick="nextHeatmapYear()"
                            style="background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); padding: 6px 12px; cursor: pointer; font-size: 0.9rem;">‚Üí</button>
                    </div>
                </div>
                <div id="faceitHeatmap" style="display: flex; gap: 8px; overflow-x: auto; padding: 5px 0;"></div>
                <div
                    style="display: flex; justify-content: flex-end; align-items: center; gap: 8px; margin-top: 10px; font-size: 0.65rem; color: var(--text-muted);">
                    <div style="width: 12px; height: 12px; background: var(--bg-input); border-radius: 3px;"></div>
                    <span>Brak treningu</span>
                    <div style="width: 12px; height: 12px; background: #10b981; border-radius: 3px; margin-left: 10px;">
                    </div>
                    <span>Trening</span>
                </div>
            </div>
        </div>

        <!-- ============ STRENGTH TAB ============ -->
        <div class="tab-content" id="tab-strength">
            <!-- Personal Records -->
            <div class="card">
                <div class="card-title">üèÜ Osobiste rekordy (PR)</div>
                <div id="recordsGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    <div style="text-align: center; padding: 20px; color: var(--text-muted);">≈Åadowanie...</div>
                </div>
            </div>

            <!-- Progression Chart -->
            <div class="card">
                <div class="card-title">üìà Progresja ciƒô≈ºaru</div>
                <div style="margin-bottom: 12px;">
                    <select id="progressionSelect" onchange="fetchProgression(this.value)" style="
                        width: 100%;
                        padding: 12px;
                        background: var(--bg-input);
                        border: 1px solid var(--border);
                        border-radius: 10px;
                        color: var(--text-primary);
                        font-size: 0.9rem;
                    ">
                        <option value="">Wybierz partiƒô cia≈Ça...</option>
                    </select>
                </div>
                <div class="progression-chart" id="progressionChart"
                    style="height: 150px; display: flex; align-items: flex-end; gap: 4px; padding-top: 25px;">
                    <div style="text-align: center; width: 100%; color: var(--text-muted); font-size: 0.85rem;">
                        Wybierz partiƒô cia≈Ça aby zobaczyƒá progresjƒô
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ MORE TAB ============ -->
        <div class="tab-content" id="tab-more">
            <div class="card">
                <div class="card-title">üíæ Eksport danych</div>
                <button class="action-button" onclick="downloadBackup()">
                    <span class="icon">üì¶</span>
                    <span class="label">Pobierz pe≈Çny backup</span>
                    <span class="arrow">‚Üí</span>
                </button>
                <button class="action-button" onclick="downloadWorkouts()">
                    <span class="icon">üèãÔ∏è</span>
                    <span class="label">Pobierz tylko treningi</span>
                    <span class="arrow">‚Üí</span>
                </button>
            </div>

            <div class="card">
                <div class="card-title">‚ÑπÔ∏è Informacje</div>
                <p style="color: var(--text-muted); font-size: 0.85rem; line-height: 1.6;">
                    <strong>Cube Tracker</strong><br>
                    Wersja 2.0 - Dashboard<br><br>
                    ≈öled≈∫ swoje treningi, sprawdzaj ob≈Ço≈ºenie si≈Çowni i analizuj statystyki.<br><br>
                    <span style="color: var(--primary-light);">stworzone przez izim üí™</span>
                </p>
            </div>

            <div class="card">
                <div class="card-title">üé® Legenda partii cia≈Ça</div>
                <div class="legend" id="fullLegend" style="margin-top: 0;"></div>
            </div>
        </div>
    </main>

    <!-- Modal for adding/editing workout -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-title" id="modalTitle">Dodaj trening</div>
            <div class="body-parts-grid" id="bodyPartsGrid"></div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeModal()">Anuluj</button>
                <button class="modal-btn danger" id="deleteBtn" onclick="deleteWorkout()"
                    style="display: none;">Usu≈Ñ</button>
                <button class="modal-btn primary" onclick="saveWorkout()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="loginOverlay" class="login-overlay hidden">
        <div class="login-modal">
            <div class="login-header">
                <span class="login-icon">üèãÔ∏è</span>
                <h2>Cube Si≈Çownia</h2>
            </div>
            <div id="loginForm" class="login-form">
                <div class="form-group">
                    <label>Nazwa u≈ºytkownika</label>
                    <input type="text" id="loginUsername" maxlength="20" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Has≈Ço</label>
                    <input type="password" id="loginPassword" maxlength="20" autocomplete="current-password">
                </div>
                <div id="loginError" class="login-error"></div>
                <button onclick="handleLogin()" class="btn-primary">Zaloguj siƒô</button>
                <div class="login-switch">Nie masz konta? <a href="#" onclick="showRegister()">Zarejestruj siƒô</a></div>
            </div>
            <div id="registerForm" class="login-form" style="display: none;">
                <div class="form-group">
                    <label>Nazwa u≈ºytkownika</label>
                    <input type="text" id="registerUsername" maxlength="20" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Has≈Ço</label>
                    <input type="password" id="registerPassword" maxlength="20" autocomplete="new-password">
                </div>
                <div id="registerError" class="login-error"></div>
                <button onclick="handleRegister()" class="btn-primary">Zarejestruj siƒô</button>
                <div class="login-switch">Masz ju≈º konto? <a href="#" onclick="showLogin()">Zaloguj siƒô</a></div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js" defer></script>
    </body>

</html>